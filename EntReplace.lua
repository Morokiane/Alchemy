-- title:  Replace Entites
-- author: BSS
-- desc:   Replace entites that have placeholder sprites for sprites to be used at runtime
-- script: lua

--[[Placeholder sprites are small squares and runtime 
are X sprites. The green placeholders have no placeholder
defined in the spawns table]]
rand = math.random
m={x=0,y=0}
--[[Sprite locations and names. orgX is placeholder and
grnX is runtime sprite]]
grnX = 17

ph={
	orgX = 1
}

hide={
	[1]=true,
	[3]=true,
	[4]=true,
	[5]=true,
	[6]=true,
}

for i=1,6 do
	hide[i]=true
end

--[[table that defines placeholder sprite and the 
actual runtime sprite. This works the same as above with
the grnX and orgX but instead of defining everything 
individually just names a table.]]
spawns={
	[3]=19,
	[4]=20,
	[5]=21
}
--[[Once the entities are added to the table they
need to be drawn on the screen through TIC]]
function TIC()
	cls()
	map(0,0,function(t) if hide[t]
	 then t=0 else t=t end return t end)

	DrawEnt()
end

--[[Init function holds the table for the runtime 
entities and runs the function to replace placeholder
sprites]]
function Init()
	ents={}
	EntLocations()
end
--[[Adds entites and their attributes to the ents table.
Type is used as the differentiator and used in the draw
function]]
function AddEnt(t)
 table.insert(ents, {
	 x=t.x,
		y=t.y,
		sprt=t.sprt or 16,
		type=t.type or "normal"
	})
end
--[[Scans the map for placeholder sprites
according to the spawns table. The spawns mget will
get the runtime sprite from the exact location on the 
sprite tab as where it is in the placeholder that 
is on the tiles tab, to cut down on elseifs. Speaking of
elseif this grabs specific tiles and is more hardcoded
for more special type entities]]
function EntLocations()
	for x=0,240 do
		for y=0,136 do
			if spawns[mget(x,y)]	then
				AddEnt({sprt=(mget(x,y)+256),x=x*8,y=y*8})
			--[[this elseif is not needed if using just the table
			to interate through the sprites.]]
			elseif mget(x,y)==ph.orgX then
				AddEnt({x=x*8,y=y*8,sprt=grnX,type="normal"})
			end
		end
	end
end
--[[Goes into TIC to draw the entities. Pulls the entity
info from the ents table according to a "type"]]
function DrawEnt()
	for i, v in pairs(ents) do
		if v.type=="normal" then
			sprt=grnX
		end
		spr(v.sprt,v.x+m.x,v.y-m.y,0 or 16)
		mset(v.x/8,v.y/8,0)--removes the placeholder sprite
	end
end

Init()
-- <TILES>
-- 001:3333333330000003300000033000000330000003300000033000000333333333
-- 003:4444444440000004400000044000000440000004400000044000000444444444
-- 004:1111111110000001100000011000000110000001100000011000000111111111
-- 005:7777777770000007700000077000000770000007700000077000000777777777
-- 006:5555555550000005500000055000000550000005500000055000000555555555
-- 016:2222222222222222222222222222222222222222222222222222222222222222
-- 017:3000000300000000003003000003300000033000003003000000000030000003
-- </TILES>

-- <SPRITES>
-- 003:4000000400000000004004000004400000044000004004000000000040000004
-- 004:1000000100000000001001000001100000011000001001000000000010000001
-- 005:7000000700000000007007000007700000077000007007000000000070000007
-- 019:0000000000000000000003000000303003303030033333000000000000000000
-- 020:0000000000330000003330000000030000000300003033000003300000000000
-- 021:0000300000033000000330000003300000033000033300000000000000000000
-- </SPRITES>

-- <MAP>
-- 003:000000500000000000000000000060000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:000000000000000050000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:000030000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:000000004000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:000000001000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:000000000000000000300000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304000000000
-- </SFX>

-- <PALETTE>
-- 000:1a1c2c5d275db13e53ef7d57ffcd75a7f07038b76425717929366f3b5dc941a6f673eff7f4f4f494b0c2566c86333c57
-- </PALETTE>

